(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{187:function(_,e,v){"use strict";v.r(e);var a=v(0),s=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var _=this,e=_.$createElement,v=_._self._c||e;return v("div",{staticClass:"content"},[v("h1",{attrs:{id:"mysql优化"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mysql优化","aria-hidden":"true"}},[_._v("#")]),_._v(" mysql优化")]),_._v(" "),v("h2",{attrs:{id:"什么是三范式"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#什么是三范式","aria-hidden":"true"}},[_._v("#")]),_._v(" 什么是三范式")]),_._v(" "),v("p",[_._v("表的范式，是首先符合1NF，才能满足2NF，进一步满足3NF。")]),_._v(" "),v("p",[_._v("1NF：表的列具有原子性，不可再分解，即列的信息不能分割。只要是关系型数据库就满足1NF。")]),_._v(" "),v("p",[_._v("2NF：表中的记录是唯一的，就满足2NF，通常用一个主键来实现。主键一般是不包含业务逻辑的自增。")]),_._v(" "),v("p",[_._v("3NF：表中不要由冗余数据，即表中的数据能被推导出来，就不应该单独设计这个字段。（在一对多的情况下，为了提高效率，可能在1这张表中，提高效率）")]),_._v(" "),v("h2",{attrs:{id:"优化主要包括以下几种方式："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#优化主要包括以下几种方式：","aria-hidden":"true"}},[_._v("#")]),_._v(" 优化主要包括以下几种方式：")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("表的设计合理化（符合3NF）")])]),_._v(" "),v("li",[v("p",[_._v("添加适当索引（可以分为主键索引、普通索引、唯一索引、符合索引、全文索引）")])]),_._v(" "),v("li",[v("p",[_._v("分表技术（水平、垂直分表）")])]),_._v(" "),v("li",[v("p",[_._v("读（select）写（update、delete、add）分离")])]),_._v(" "),v("li",[v("p",[_._v("存储过程（模块化编程，可以提高编程）")])]),_._v(" "),v("li",[v("p",[_._v("对mysql的配置优化")]),_._v(" "),v("ul",[v("li",[_._v("配置最大并发数")]),_._v(" "),v("li",[_._v("调整缓存大小")])])])]),_._v(" "),v("p",[_._v("7.mysql服务器硬件升级")]),_._v(" "),v("p",[_._v("8.定时清除不需要的数据，定时进行碎片整理")]),_._v(" "),v("p",[_._v("mysql是一个dbms即关系数据管理系统，sql语句写好之后，由数据库对我们进行编译并执行。而存储过程是事先编译好了。")]),_._v(" "),v("h2",{attrs:{id:"sql语句本身的优化"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sql语句本身的优化","aria-hidden":"true"}},[_._v("#")]),_._v(" sql语句本身的优化")]),_._v(" "),v("p",[_._v("从项目中迅速定位执行速度慢的语句（定位慢查询）。")]),_._v(" "),v("p",[_._v("​-  "),v("code",[_._v("show [session|global（session会话级别，默认session）]status")]),_._v("可以显示数据库的状态：")]),_._v(" "),v("ul",[v("li",[v("code",[_._v("show status like 'uptime'\t ;")]),_._v("显示运行时间")]),_._v(" "),v("li",[v("code",[_._v("show status like 'com_select'（select、update、add、delete）;")]),_._v("当前执行的多少次查询")]),_._v(" "),v("li",[v("code",[_._v("show status like 'connections';")]),_._v("显示连接数")]),_._v(" "),v("li",[_._v("`show status like 'slow_queries';``显示慢查询次数（mysql默认10s以上是慢查询）")]),_._v(" "),v("li",[v("code",[_._v("show variables like 'long_query_time';")]),_._v("可以显示当前慢查询时间。")]),_._v(" "),v("li",[v("code",[_._v("set long_query_time = 1;")]),_._v("修改慢查询的时间为1秒。")])]),_._v(" "),v("p",[_._v("默认情况下，mysql不会记录慢查询，需要在启动mysql的时候，指定记录慢查询。")]),_._v(" "),v("p",[_._v("在log文件中，可以查看满查询的信息。")]),_._v(" "),v("h2",{attrs:{id:"建立适当的索引，是最方便的提高效率的方式。"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#建立适当的索引，是最方便的提高效率的方式。","aria-hidden":"true"}},[_._v("#")]),_._v(" 建立适当的索引，是最方便的提高效率的方式。")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("添加索引")]),_._v(" "),v("blockquote",[v("p",[_._v("主键索引")]),_._v(" "),v("p",[_._v("主键索引不能为空，也不能重复")]),_._v(" "),v("p",[_._v("当把一张表，某个列设为主键的时候，则该列就是主键索引")]),_._v(" "),v("p",[_._v("创建主键索引："),v("code",[_._v("alter table 表名 add primary key [索引名] 列名")])])]),_._v(" "),v("blockquote",[v("p",[_._v("普通索引")]),_._v(" "),v("p",[_._v("一般是先有表，再创建普通索引")]),_._v(" "),v("p",[v("code",[_._v("create index 索引名 on 表名 (列1，列2)")])])]),_._v(" "),v("blockquote",[v("p",[_._v("全文索引")]),_._v(" "),v("p",[_._v("FULLTEXT索引仅可用于myisam数据库")]),_._v(" "),v("p",[_._v("全文索引的使用方法：")]),_._v(" "),v("p",[v("code",[_._v("select * from 表名 where match(列a,列b...) against('关键字')")])]),_._v(" "),v("p",[_._v("针对英文生效，需要使用sphinx（coreseek）技术处理中文")]),_._v(" "),v("p",[_._v("停用词：一些常用词和字符就不会创建索引")])]),_._v(" "),v("blockquote",[v("p",[_._v("唯一索引")]),_._v(" "),v("p",[_._v("当表的某列被指定为unique约束是，这个列就是一个唯一索引")]),_._v(" "),v("p",[_._v("唯一索引可以为空，且能多个空。")]),_._v(" "),v("p",[v("code",[_._v("create unique 索引名 on 表名 （字段列表）")])])])]),_._v(" "),v("li",[v("p",[_._v("查询索引")]),_._v(" "),v("blockquote",[v("p",[_._v("desc 表名； 缺点：不能显示索引名称")]),_._v(" "),v("p",[v("code",[_._v("show index from 表名")])]),_._v(" "),v("p",[v("code",[_._v("show keys from 表名")])])])]),_._v(" "),v("li",[v("p",[_._v("删除索引")]),_._v(" "),v("blockquote",[v("p",[v("code",[_._v("alter table 表名 drop index 索引名;")])]),_._v(" "),v("p",[_._v("删除主键索引还有其他方法：")]),_._v(" "),v("p",[v("code",[_._v("alter table 表名 drop primary key;(因为一个表只有一个主键索引，不用去指定索引名)")])])])]),_._v(" "),v("li",[v("p",[_._v("修改索引")]),_._v(" "),v("blockquote",[v("p",[_._v("先删除再创建")])])])]),_._v(" "),v("h3",{attrs:{id:"使用索引的注意事项："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用索引的注意事项：","aria-hidden":"true"}},[_._v("#")]),_._v(" 使用索引的注意事项：")]),_._v(" "),v("ul",[v("li",[_._v("占用磁盘空间")]),_._v(" "),v("li",[_._v("对dml操作有影响，会变慢。（增删改的时候，索引会改变，需要重整索引）")]),_._v(" "),v("li",[_._v("适合所有的情况\n"),v("ul",[v("li",[_._v("较频繁额作为查询条件字段应该创建索引")]),_._v(" "),v("li",[_._v("内容单一的字段不该创建索引（比如都是1、0的等）")]),_._v(" "),v("li",[_._v("更新很频繁的字段不适合创建索引")]),_._v(" "),v("li",[_._v("不会出现在where子句中字段不该创建索引")])])])]),_._v(" "),v("h3",{attrs:{id:"索引的使用："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#索引的使用：","aria-hidden":"true"}},[_._v("#")]),_._v(" 索引的使用：")]),_._v(" "),v("ul",[v("li",[_._v("如果索引中有复合索引，使用了最左边的列，就会启用这个索引。")]),_._v(" "),v("li",[_._v("在使用模糊查询的时候，如果左边有‘%’，则索引失效。")]),_._v(" "),v("li",[_._v("如果条件中有 or，要求所有字段都必须建立索引。建议少使用or关键字。")]),_._v(" "),v("li",[_._v("如果列类型是字符串，则一定要在条件中将数据使用引号引起来。")]),_._v(" "),v("li",[_._v("如果全表扫描比使用索引快，则不适用索引。")])]),_._v(" "),v("h3",{attrs:{id:"查看索引的使用情况："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#查看索引的使用情况：","aria-hidden":"true"}},[_._v("#")]),_._v(" 查看索引的使用情况：")]),_._v(" "),v("div",{staticClass:"language-java extra-class"},[v("pre",{pre:!0,attrs:{class:"language-java"}},[v("code",[_._v("show status like "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'Handler_read%'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n返回实例：\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_first")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("10")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_key")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("1327")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_last")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("0")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_next")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("288")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_prev")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("0")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_rnd")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("13063")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("Handler_read_rnd_next")]),_._v("\t"),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("69252")]),_._v("\n\nhandler_readk_key"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v(":")]),_._v("这个值越高越好；\nhandler_read_rnd_next：这个值越高，说明查询效率低\n")])])]),v("h3",{attrs:{id:"sql小技巧："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sql小技巧：","aria-hidden":"true"}},[_._v("#")]),_._v(" sql小技巧：")]),_._v(" "),v("ul",[v("li",[_._v("在使用"),v("code",[_._v("group by")]),_._v("分组查询时，默认分组后，还会排序，可能降低速度。在后面增加"),v("code",[_._v("order by null")]),_._v("可以防止排序。")]),_._v(" "),v("li",[_._v("有的情况下，可以使用连接来替代子查询。因为join在mysql中不需要创建临时表。（使用左外连接更好）")])]),_._v(" "),v("h2",{attrs:{id:"mysql存储引擎的选择"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mysql存储引擎的选择","aria-hidden":"true"}},[_._v("#")]),_._v(" mysql存储引擎的选择")]),_._v(" "),v("ul",[v("li",[v("code",[_._v("myisam")]),_._v("存储：对事务要求不高，同时以查询和添加为主的。例如bbs中的发帖，回复表。")]),_._v(" "),v("li",[v("code",[_._v("innodb")]),_._v("存储：对事务要求比较高，保存的都是重要数据。如订单表，账号表。")]),_._v(" "),v("li",[v("code",[_._v("memory")]),_._v("存储：数据变化频繁，不需要入库，同时又频繁的查询和修改。")])]),_._v(" "),v("h3",{attrs:{id:"myisam和innodb的区别"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#myisam和innodb的区别","aria-hidden":"true"}},[_._v("#")]),_._v(" "),v("code",[_._v("myisam")]),_._v("和"),v("code",[_._v("innodb")]),_._v("的区别")]),_._v(" "),v("ul",[v("li",[_._v("事务安全:"),v("code",[_._v("innodb")]),_._v("事务安全")]),_._v(" "),v("li",[_._v("查询和添加:"),v("code",[_._v("myisam")]),_._v("查询添加快")]),_._v(" "),v("li",[_._v("全文索引:仅适合于"),v("code",[_._v("myisam")])]),_._v(" "),v("li",[_._v("锁机制:"),v("code",[_._v("myisam")]),_._v("表锁，"),v("code",[_._v("innodb")]),_._v("行锁")]),_._v(" "),v("li",[_._v("外键:"),v("code",[_._v("myisam")]),_._v("不支持外键")]),_._v(" "),v("li",[_._v("定时清理:"),v("code",[_._v("myisam")]),_._v("需要定时整理:"),v("code",[_._v("optimize table 表名")])])]),_._v(" "),v("div",{attrs:{align:"center"}},[v("img",{attrs:{src:"http://qiniu.xuchen.link/6e1998963270bfa50aa0c04ff5c08553.png",title:"数据库引擎区别",width:"800",height:"500"}}),v("div",[_._v("数据库引擎区别")])])])}],!1,null,null,null);e.default=s.exports}}]);