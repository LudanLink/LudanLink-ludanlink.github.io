<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql优化 | 白 日 淡</title>
    <meta name="description" content="空空而来，又怎能空空而去">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.0d19fd84.css" as="style"><link rel="preload" href="/assets/js/app.07421936.js" as="script"><link rel="preload" href="/assets/js/37.9202d6c9.js" as="script"><link rel="prefetch" href="/assets/js/10.da7d1ee6.js"><link rel="prefetch" href="/assets/js/11.b2419c0a.js"><link rel="prefetch" href="/assets/js/12.91038659.js"><link rel="prefetch" href="/assets/js/13.16f6d96c.js"><link rel="prefetch" href="/assets/js/14.717547c1.js"><link rel="prefetch" href="/assets/js/15.7024b64f.js"><link rel="prefetch" href="/assets/js/16.e6fd1184.js"><link rel="prefetch" href="/assets/js/17.5ade8dfb.js"><link rel="prefetch" href="/assets/js/18.98b5a4b1.js"><link rel="prefetch" href="/assets/js/19.43aa5948.js"><link rel="prefetch" href="/assets/js/2.9c18cab0.js"><link rel="prefetch" href="/assets/js/20.fffefcad.js"><link rel="prefetch" href="/assets/js/21.aadaff04.js"><link rel="prefetch" href="/assets/js/22.ad8ef7fa.js"><link rel="prefetch" href="/assets/js/23.fc9bc37b.js"><link rel="prefetch" href="/assets/js/24.e3406894.js"><link rel="prefetch" href="/assets/js/25.b5a9fc9b.js"><link rel="prefetch" href="/assets/js/26.1b5eae32.js"><link rel="prefetch" href="/assets/js/27.c85a8cc9.js"><link rel="prefetch" href="/assets/js/28.85b53558.js"><link rel="prefetch" href="/assets/js/29.c96a2c43.js"><link rel="prefetch" href="/assets/js/3.3e457bc3.js"><link rel="prefetch" href="/assets/js/30.a9cf47bf.js"><link rel="prefetch" href="/assets/js/31.35767153.js"><link rel="prefetch" href="/assets/js/32.da2a97a5.js"><link rel="prefetch" href="/assets/js/33.54660318.js"><link rel="prefetch" href="/assets/js/34.c16c6ee1.js"><link rel="prefetch" href="/assets/js/35.13feed40.js"><link rel="prefetch" href="/assets/js/36.0c34aed6.js"><link rel="prefetch" href="/assets/js/38.f8e129a2.js"><link rel="prefetch" href="/assets/js/39.0021dfc1.js"><link rel="prefetch" href="/assets/js/4.b39abf1d.js"><link rel="prefetch" href="/assets/js/40.d374cda1.js"><link rel="prefetch" href="/assets/js/41.eb48efb9.js"><link rel="prefetch" href="/assets/js/42.c2f93674.js"><link rel="prefetch" href="/assets/js/43.e2ce89c2.js"><link rel="prefetch" href="/assets/js/44.aaf30fa0.js"><link rel="prefetch" href="/assets/js/45.655cd797.js"><link rel="prefetch" href="/assets/js/46.757b1616.js"><link rel="prefetch" href="/assets/js/47.dfbd58c8.js"><link rel="prefetch" href="/assets/js/48.ddcab0e9.js"><link rel="prefetch" href="/assets/js/49.47ce1e24.js"><link rel="prefetch" href="/assets/js/5.4518cf99.js"><link rel="prefetch" href="/assets/js/50.2f72f340.js"><link rel="prefetch" href="/assets/js/51.51bf10d2.js"><link rel="prefetch" href="/assets/js/52.915d4928.js"><link rel="prefetch" href="/assets/js/53.050f68ad.js"><link rel="prefetch" href="/assets/js/54.2fca5495.js"><link rel="prefetch" href="/assets/js/55.9779c5a2.js"><link rel="prefetch" href="/assets/js/56.02b0dbbd.js"><link rel="prefetch" href="/assets/js/57.632fdb32.js"><link rel="prefetch" href="/assets/js/58.470f45fc.js"><link rel="prefetch" href="/assets/js/59.ad62ca3e.js"><link rel="prefetch" href="/assets/js/6.1185b8bd.js"><link rel="prefetch" href="/assets/js/60.36c90e5d.js"><link rel="prefetch" href="/assets/js/61.ecfed753.js"><link rel="prefetch" href="/assets/js/62.bd28e9c4.js"><link rel="prefetch" href="/assets/js/63.85dcd7b8.js"><link rel="prefetch" href="/assets/js/64.4d8ebbb4.js"><link rel="prefetch" href="/assets/js/65.ddaa4c0d.js"><link rel="prefetch" href="/assets/js/66.b275255b.js"><link rel="prefetch" href="/assets/js/67.f3c5c614.js"><link rel="prefetch" href="/assets/js/7.2127d0de.js"><link rel="prefetch" href="/assets/js/8.760e0ac9.js"><link rel="prefetch" href="/assets/js/9.01276f18.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0d19fd84.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">白 日 淡</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/zh/sources/" class="nav-link">资源收集</a></div><div class="nav-item"><a href="/zh/guoxue/" class="nav-link">国学</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/316beb0573ae" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/zh/unfilter/" class="nav-link">未分类</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/zh/sources/" class="nav-link">资源收集</a></div><div class="nav-item"><a href="/zh/guoxue/" class="nav-link">国学</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/316beb0573ae" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/zh/unfilter/" class="nav-link">未分类</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>mysql数据库</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/database/mysql/" class="sidebar-link">MySQL</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>mysql数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/zh/database/mysql/mysql优化.html" class="active sidebar-link">mysql优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/database/mysql/mysql优化.html#什么是三范式" class="sidebar-link">什么是三范式</a></li><li class="sidebar-sub-header"><a href="/zh/database/mysql/mysql优化.html#优化主要包括以下几种方式：" class="sidebar-link">优化主要包括以下几种方式：</a></li><li class="sidebar-sub-header"><a href="/zh/database/mysql/mysql优化.html#sql语句本身的优化" class="sidebar-link">sql语句本身的优化</a></li><li class="sidebar-sub-header"><a href="/zh/database/mysql/mysql优化.html#建立适当的索引，是最方便的提高效率的方式。" class="sidebar-link">建立适当的索引，是最方便的提高效率的方式。</a></li><li class="sidebar-sub-header"><a href="/zh/database/mysql/mysql优化.html#mysql存储引擎的选择" class="sidebar-link">mysql存储引擎的选择</a></li></ul></li><li><a href="/zh/database/mysql/MybatisGenerator配置说明.html" class="sidebar-link">Mybatis Generator配置说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/database/mysql/MybatisGenerator配置说明.html#文件详情" class="sidebar-link">文件详情</a></li><li class="sidebar-sub-header"><a href="/zh/database/mysql/MybatisGenerator配置说明.html#文件下载" class="sidebar-link">文件下载</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mysql优化"><a href="#mysql优化" aria-hidden="true" class="header-anchor">#</a> mysql优化</h1> <h2 id="什么是三范式"><a href="#什么是三范式" aria-hidden="true" class="header-anchor">#</a> 什么是三范式</h2> <p>表的范式，是首先符合1NF，才能满足2NF，进一步满足3NF。</p> <p>1NF：表的列具有原子性，不可再分解，即列的信息不能分割。只要是关系型数据库就满足1NF。</p> <p>2NF：表中的记录是唯一的，就满足2NF，通常用一个主键来实现。主键一般是不包含业务逻辑的自增。</p> <p>3NF：表中不要由冗余数据，即表中的数据能被推导出来，就不应该单独设计这个字段。（在一对多的情况下，为了提高效率，可能在1这张表中，提高效率）</p> <h2 id="优化主要包括以下几种方式："><a href="#优化主要包括以下几种方式：" aria-hidden="true" class="header-anchor">#</a> 优化主要包括以下几种方式：</h2> <ol><li><p>表的设计合理化（符合3NF）</p></li> <li><p>添加适当索引（可以分为主键索引、普通索引、唯一索引、符合索引、全文索引）</p></li> <li><p>分表技术（水平、垂直分表）</p></li> <li><p>读（select）写（update、delete、add）分离</p></li> <li><p>存储过程（模块化编程，可以提高编程）</p></li> <li><p>对mysql的配置优化</p> <ul><li>配置最大并发数</li> <li>调整缓存大小</li></ul></li></ol> <p>7.mysql服务器硬件升级</p> <p>8.定时清除不需要的数据，定时进行碎片整理</p> <p>mysql是一个dbms即关系数据管理系统，sql语句写好之后，由数据库对我们进行编译并执行。而存储过程是事先编译好了。</p> <h2 id="sql语句本身的优化"><a href="#sql语句本身的优化" aria-hidden="true" class="header-anchor">#</a> sql语句本身的优化</h2> <p>从项目中迅速定位执行速度慢的语句（定位慢查询）。</p> <p>​-  <code>show [session|global（session会话级别，默认session）]status</code>可以显示数据库的状态：</p> <ul><li><code>show status like 'uptime'	 ;</code>显示运行时间</li> <li><code>show status like 'com_select'（select、update、add、delete）;</code>当前执行的多少次查询</li> <li><code>show status like 'connections';</code>显示连接数</li> <li>`show status like 'slow_queries';``显示慢查询次数（mysql默认10s以上是慢查询）</li> <li><code>show variables like 'long_query_time';</code>可以显示当前慢查询时间。</li> <li><code>set long_query_time = 1;</code>修改慢查询的时间为1秒。</li></ul> <p>默认情况下，mysql不会记录慢查询，需要在启动mysql的时候，指定记录慢查询。</p> <p>在log文件中，可以查看满查询的信息。</p> <h2 id="建立适当的索引，是最方便的提高效率的方式。"><a href="#建立适当的索引，是最方便的提高效率的方式。" aria-hidden="true" class="header-anchor">#</a> 建立适当的索引，是最方便的提高效率的方式。</h2> <ol><li><p>添加索引</p> <blockquote><p>主键索引</p> <p>主键索引不能为空，也不能重复</p> <p>当把一张表，某个列设为主键的时候，则该列就是主键索引</p> <p>创建主键索引：<code>alter table 表名 add primary key [索引名] 列名</code></p></blockquote> <blockquote><p>普通索引</p> <p>一般是先有表，再创建普通索引</p> <p><code>create index 索引名 on 表名 (列1，列2)</code></p></blockquote> <blockquote><p>全文索引</p> <p>FULLTEXT索引仅可用于myisam数据库</p> <p>全文索引的使用方法：</p> <p><code>select * from 表名 where match(列a,列b...) against('关键字')</code></p> <p>针对英文生效，需要使用sphinx（coreseek）技术处理中文</p> <p>停用词：一些常用词和字符就不会创建索引</p></blockquote> <blockquote><p>唯一索引</p> <p>当表的某列被指定为unique约束是，这个列就是一个唯一索引</p> <p>唯一索引可以为空，且能多个空。</p> <p><code>create unique 索引名 on 表名 （字段列表）</code></p></blockquote></li> <li><p>查询索引</p> <blockquote><p>desc 表名； 缺点：不能显示索引名称</p> <p><code>show index from 表名</code></p> <p><code>show keys from 表名</code></p></blockquote></li> <li><p>删除索引</p> <blockquote><p><code>alter table 表名 drop index 索引名;</code></p> <p>删除主键索引还有其他方法：</p> <p><code>alter table 表名 drop primary key;(因为一个表只有一个主键索引，不用去指定索引名)</code></p></blockquote></li> <li><p>修改索引</p> <blockquote><p>先删除再创建</p></blockquote></li></ol> <h3 id="使用索引的注意事项："><a href="#使用索引的注意事项：" aria-hidden="true" class="header-anchor">#</a> 使用索引的注意事项：</h3> <ul><li>占用磁盘空间</li> <li>对dml操作有影响，会变慢。（增删改的时候，索引会改变，需要重整索引）</li> <li>适合所有的情况
<ul><li>较频繁额作为查询条件字段应该创建索引</li> <li>内容单一的字段不该创建索引（比如都是1、0的等）</li> <li>更新很频繁的字段不适合创建索引</li> <li>不会出现在where子句中字段不该创建索引</li></ul></li></ul> <h3 id="索引的使用："><a href="#索引的使用：" aria-hidden="true" class="header-anchor">#</a> 索引的使用：</h3> <ul><li>如果索引中有复合索引，使用了最左边的列，就会启用这个索引。</li> <li>在使用模糊查询的时候，如果左边有‘%’，则索引失效。</li> <li>如果条件中有 or，要求所有字段都必须建立索引。建议少使用or关键字。</li> <li>如果列类型是字符串，则一定要在条件中将数据使用引号引起来。</li> <li>如果全表扫描比使用索引快，则不适用索引。</li></ul> <h3 id="查看索引的使用情况："><a href="#查看索引的使用情况：" aria-hidden="true" class="header-anchor">#</a> 查看索引的使用情况：</h3> <div class="language-java extra-class"><pre class="language-java"><code>show status like <span class="token string">'Handler_read%'</span><span class="token punctuation">;</span>
返回实例：
<span class="token class-name">Handler_read_first</span>	<span class="token number">10</span>
<span class="token class-name">Handler_read_key</span>	<span class="token number">1327</span>
<span class="token class-name">Handler_read_last</span>	<span class="token number">0</span>
<span class="token class-name">Handler_read_next</span>	<span class="token number">288</span>
<span class="token class-name">Handler_read_prev</span>	<span class="token number">0</span>
<span class="token class-name">Handler_read_rnd</span>	<span class="token number">13063</span>
<span class="token class-name">Handler_read_rnd_next</span>	<span class="token number">69252</span>

handler_readk_key<span class="token operator">:</span>这个值越高越好；
handler_read_rnd_next：这个值越高，说明查询效率低
</code></pre></div><h3 id="sql小技巧："><a href="#sql小技巧：" aria-hidden="true" class="header-anchor">#</a> sql小技巧：</h3> <ul><li>在使用<code>group by</code>分组查询时，默认分组后，还会排序，可能降低速度。在后面增加<code>order by null</code>可以防止排序。</li> <li>有的情况下，可以使用连接来替代子查询。因为join在mysql中不需要创建临时表。（使用左外连接更好）</li></ul> <h2 id="mysql存储引擎的选择"><a href="#mysql存储引擎的选择" aria-hidden="true" class="header-anchor">#</a> mysql存储引擎的选择</h2> <ul><li><code>myisam</code>存储：对事务要求不高，同时以查询和添加为主的。例如bbs中的发帖，回复表。</li> <li><code>innodb</code>存储：对事务要求比较高，保存的都是重要数据。如订单表，账号表。</li> <li><code>memory</code>存储：数据变化频繁，不需要入库，同时又频繁的查询和修改。</li></ul> <h3 id="myisam和innodb的区别"><a href="#myisam和innodb的区别" aria-hidden="true" class="header-anchor">#</a> <code>myisam</code>和<code>innodb</code>的区别</h3> <ul><li>事务安全:<code>innodb</code>事务安全</li> <li>查询和添加:<code>myisam</code>查询添加快</li> <li>全文索引:仅适合于<code>myisam</code></li> <li>锁机制:<code>myisam</code>表锁，<code>innodb</code>行锁</li> <li>外键:<code>myisam</code>不支持外键</li> <li>定时清理:<code>myisam</code>需要定时整理:<code>optimize table 表名</code></li></ul> <div align="center"><img src="http://qiniu.xuchen.link/6e1998963270bfa50aa0c04ff5c08553.png" title="数据库引擎区别" width="800" height="500"><div>数据库引擎区别</div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.07421936.js" defer></script><script src="/assets/js/37.9202d6c9.js" defer></script>
  </body>
</html>
